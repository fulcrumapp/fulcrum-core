{"version":3,"file":"choice-element.js","names":["ChoiceElement","parent","attributes","multiple","allowOther","allow_other","_choiceFilter","_overrideChoices","_choiceListID","choice_list_id","_choices","choices","choice","push","Choice","load","dataSource","callback","_choicesByValue","getChoiceList","err","choiceList","slice","setImmediate","resetOverrides","choiceByValue","value","filteredChoices","choiceFilter","items","filteredItems","matchedValues","item","filter","isMatch","toLowerCase","indexOf","overrideChoices","length","choiceAttributes","Object","assign","getOwnPropertyDescriptor","Element","prototype","get","call"],"sources":["../../src/elements/choice-element.js"],"sourcesContent":["import Element from './element';\nimport Choice from './choice';\n\nexport default class ChoiceElement extends Element {\n  constructor(parent, attributes) {\n    super(parent, attributes);\n\n    this.multiple = !!attributes.multiple;\n    this.allowOther = !!attributes.allow_other;\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n\n    this._choiceListID = attributes.choice_list_id;\n    this._choices = [];\n\n    // TODO(zhm) the loading needs to be re-worked to support choice lists\n    if (attributes.choices) {\n      for (const choice of attributes.choices) {\n        this._choices.push(new Choice(choice));\n      }\n    }\n  }\n\n  load(dataSource, callback) {\n    this._choicesByValue = null;\n\n    if (this._choiceListID) {\n      dataSource.getChoiceList(this._choiceListID, (err, choiceList) => {\n        // TODO(zhm) Some forms have orphaned choice lists (life sucks)\n        // Maybe we should add a parameter to the load() method to throw\n        // errors.\n        if (err) {\n          return callback(err);\n        }\n\n        this.choiceList = choiceList;\n        this._choices = this.choiceList.choices.slice();\n\n        return callback();\n      });\n    } else {\n      setImmediate(callback);\n    }\n  }\n\n  get isLengthValidationSupported() {\n    return this.multiple;\n  }\n\n  get choices() {\n    return this._overrideChoices ? this._overrideChoices : this.filteredChoices;\n  }\n\n  get choiceFilter() {\n    return this._choiceFilter;\n  }\n\n  set choiceFilter(choiceFilter) {\n    this._choiceFilter = choiceFilter;\n  }\n\n  get filteredChoices() {\n    const items = this._choices;\n\n    if (!this.choiceFilter) {\n      return items;\n    }\n\n    const filteredItems = [];\n    const matchedValues = {};\n\n    for (const item of items) {\n      for (const filter of this.choiceFilter) {\n        const isMatch = item.value.toLowerCase().indexOf(filter.toLowerCase()) !== -1;\n\n        if (isMatch && !matchedValues[item.value]) {\n          filteredItems.push(item);\n          matchedValues[item.value] = item;\n        }\n      }\n    }\n\n    return filteredItems;\n  }\n\n  get overrideChoices() {\n    return this._overrideChoices;\n  }\n\n  set overrideChoices(overrideChoices) {\n    this._choicesByValue = null;\n\n    if (!overrideChoices || overrideChoices.length < 1) {\n      this._overrideChoices = null;\n      return;\n    }\n\n    const choices = [];\n\n    for (const choiceAttributes of overrideChoices) {\n      const choice = new Choice(choiceAttributes);\n\n      choices.push(choice);\n    }\n\n    this._overrideChoices = choices;\n  }\n\n  get overrideValues() {\n    return Object.assign(Object.getOwnPropertyDescriptor(Element.prototype, 'overrideValues').get.call(this), {\n      choiceFilter: this._choiceFilter,\n      overrideChoices: this._overrideChoices\n    });\n  }\n\n  resetOverrides() {\n    super.resetOverrides();\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n  }\n\n  choiceByValue(value) {\n    if (!this._choicesByValue) {\n      this._choicesByValue = {};\n\n      for (const choice of this.choices) {\n        this._choicesByValue[choice.value] = choice;\n      }\n    }\n\n    return this._choicesByValue[value];\n  }\n}\n"],"mappings":"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"}