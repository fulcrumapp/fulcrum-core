{"version":3,"file":"choice-element.js","names":["ChoiceElement","parent","attributes","multiple","allowOther","allow_other","_choiceFilter","_overrideChoices","_choiceListID","choice_list_id","_choices","choices","choice","push","Choice","load","dataSource","callback","_choicesByValue","getChoiceList","err","choiceList","slice","setImmediate","resetOverrides","choiceByValue","value","filteredChoices","choiceFilter","items","filteredItems","matchedValues","item","filter","isMatch","toLowerCase","indexOf","overrideChoices","length","choiceAttributes","Object","assign","getOwnPropertyDescriptor","Element","prototype","get","call"],"sources":["../../src/elements/choice-element.js"],"sourcesContent":["import Element from './element';\nimport Choice from './choice';\n\nexport default class ChoiceElement extends Element {\n  constructor(parent, attributes) {\n    super(parent, attributes);\n\n    this.multiple = !!attributes.multiple;\n    this.allowOther = !!attributes.allow_other;\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n\n    this._choiceListID = attributes.choice_list_id;\n    this._choices = [];\n\n    // TODO(zhm) the loading needs to be re-worked to support choice lists\n    if (attributes.choices) {\n      for (const choice of attributes.choices) {\n        this._choices.push(new Choice(choice));\n      }\n    }\n  }\n\n  load(dataSource, callback) {\n    this._choicesByValue = null;\n\n    if (this._choiceListID) {\n      dataSource.getChoiceList(this._choiceListID, (err, choiceList) => {\n        // TODO(zhm) Some forms have orphaned choice lists (life sucks)\n        // Maybe we should add a parameter to the load() method to throw\n        // errors.\n        if (err) {\n          return callback(err);\n        }\n\n        this.choiceList = choiceList;\n        this._choices = this.choiceList.choices.slice();\n\n        return callback();\n      });\n    } else {\n      setImmediate(callback);\n    }\n  }\n\n  get isLengthValidationSupported() {\n    return this.multiple;\n  }\n\n  get choices() {\n    return this._overrideChoices ? this._overrideChoices : this.filteredChoices;\n  }\n\n  get choiceFilter() {\n    return this._choiceFilter;\n  }\n\n  set choiceFilter(choiceFilter) {\n    this._choiceFilter = choiceFilter;\n  }\n\n  get filteredChoices() {\n    const items = this._choices;\n\n    if (!this.choiceFilter) {\n      return items;\n    }\n\n    const filteredItems = [];\n    const matchedValues = {};\n\n    for (const item of items) {\n      for (const filter of this.choiceFilter) {\n        const isMatch = item.value.toLowerCase().indexOf(filter.toLowerCase()) !== -1;\n\n        if (isMatch && !matchedValues[item.value]) {\n          filteredItems.push(item);\n          matchedValues[item.value] = item;\n        }\n      }\n    }\n\n    return filteredItems;\n  }\n\n  get overrideChoices() {\n    return this._overrideChoices;\n  }\n\n  set overrideChoices(overrideChoices) {\n    this._choicesByValue = null;\n\n    if (!overrideChoices || overrideChoices.length < 1) {\n      this._overrideChoices = null;\n      return;\n    }\n\n    const choices = [];\n\n    for (const choiceAttributes of overrideChoices) {\n      const choice = new Choice(choiceAttributes);\n\n      choices.push(choice);\n    }\n\n    this._overrideChoices = choices;\n  }\n\n  get overrideValues() {\n    return Object.assign(Object.getOwnPropertyDescriptor(Element.prototype, 'overrideValues').get.call(this), {\n      choiceFilter: this._choiceFilter,\n      overrideChoices: this._overrideChoices\n    });\n  }\n\n  resetOverrides() {\n    super.resetOverrides();\n\n    this._choiceFilter = null;\n    this._overrideChoices = null;\n  }\n\n  choiceByValue(value) {\n    if (!this._choicesByValue) {\n      this._choicesByValue = {};\n\n      for (const choice of this.choices) {\n        this._choicesByValue[choice.value] = choice;\n      }\n    }\n\n    return this._choicesByValue[value];\n  }\n}\n"],"mappings":"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"}