{"version":3,"sources":["../../src/values/choice-value.js"],"names":["ChoiceDisplaySeparator","ChoiceSearchSeparator","ChoiceValue","element","attributes","_choiceValues","_otherValues","choice_values","choice","TextUtils","isPresent","push","other_values","format","useDisplayValue","isEmpty","values","labelStrings","sort","valueStrings","multiple","toJSON","choiceValues","otherValues","rawValue","otherValue","toSimpleJSON","labels","strings","isEqual","value","selectedValues","contains","startsWith","length","choiceByValue","label","join","allValues","slice","hasOtherValue","FormValue"],"mappings":"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","sourcesContent":["import FormValue from './form-value';\nimport TextUtils from '../utils/text-utils';\nimport includes from 'lodash.includes';\n\nconst ChoiceDisplaySeparator = ', ';\nconst ChoiceSearchSeparator = ' ';\n\nexport default class ChoiceValue extends FormValue {\n  constructor(element, attributes) {\n    super(element, attributes);\n\n    this._choiceValues = [];\n    this._otherValues = [];\n\n    if (attributes) {\n      if (attributes.choice_values) {\n        for (const choice of attributes.choice_values) {\n          if (TextUtils.isPresent(choice)) {\n            this._choiceValues.push(choice);\n          }\n        }\n      }\n\n      if (attributes.other_values) {\n        for (const choice of attributes.other_values) {\n          if (TextUtils.isPresent(choice)) {\n            this._otherValues.push(choice);\n          }\n        }\n      }\n    }\n  }\n\n  get isEmpty() {\n    if (this._choiceValues.length) {\n      return false;\n    }\n    if (this._otherValues.length) {\n      return false;\n    }\n    return true;\n  }\n\n  format({useDisplayValue = false}) {\n    if (this.isEmpty) {\n      return null;\n    }\n\n    const values = useDisplayValue ? this.labelStrings.sort() : this.valueStrings.sort();\n\n    if (!this.element.multiple) {\n      return values[0];\n    }\n\n    return values;\n  }\n\n  get labelStrings() {\n    const labels = [];\n\n    for (const rawValue of this._choiceValues) {\n      const choice = this.element.choiceByValue(rawValue);\n\n      const label = (choice != null ? choice.label : rawValue);\n\n      if (TextUtils.isPresent(label)) {\n        labels.push(label);\n      }\n    }\n\n    for (const otherValue of this._otherValues) {\n      labels.push(otherValue);\n    }\n\n    return labels;\n  }\n\n  get valueStrings() {\n    const values = [];\n\n    for (const rawValue of this._choiceValues) {\n      values.push(rawValue);\n    }\n\n    for (const otherValue of this._otherValues) {\n      values.push(otherValue);\n    }\n\n    return values;\n  }\n\n  get displayValue() {\n    return this.labelStrings.join(ChoiceDisplaySeparator);\n  }\n\n  get searchableValue() {\n    const values = [];\n\n    for (const rawValue of this._choiceValues) {\n      const choice = this.element.choiceByValue(rawValue);\n\n      if (choice != null) {\n        values.push(choice.label);\n\n        if (choice.label !== choice.value) {\n          values.push(choice.value);\n        }\n      } else {\n        values.push(rawValue);\n      }\n    }\n\n    for (const otherValue of this._otherValues) {\n      values.push(otherValue);\n    }\n\n    return values.join(ChoiceSearchSeparator);\n  }\n\n  get length() {\n    return this._choiceValues.length + this._otherValues.length;\n  }\n\n  toJSON() {\n    if (this.isEmpty) {\n      return null;\n    }\n\n    const choiceValues = [];\n    const otherValues = [];\n\n    for (const rawValue of this._choiceValues) {\n      choiceValues.push(rawValue);\n    }\n\n    for (const otherValue of this._otherValues) {\n      otherValues.push(otherValue);\n    }\n\n    return {\n      choice_values: choiceValues,\n      other_values: otherValues\n    };\n  }\n\n  toSimpleJSON({labels} = {}) {\n    if (this.isEmpty) {\n      return null;\n    }\n\n    const strings = labels ? this.labelStrings : this.valueStrings;\n\n    return this.element.multiple ? strings : strings[0];\n  }\n\n  get columnValue() {\n    const allValues = this.valueStrings.sort();\n\n    if (allValues.length === 0) {\n      return null;\n    }\n\n    if (!this.element.multiple) {\n      return allValues[0];\n    }\n\n    return allValues;\n  }\n\n  get multipleValues() {\n    return null;\n  }\n\n  get hasOtherValue() {\n    return this._otherValues.length !== 0;\n  }\n\n  get selectedValues() {\n    return this._choiceValues.slice();\n  }\n\n  set selectedValues(values) {\n    this._choiceValues = (values || []).slice();\n  }\n\n  get otherValues() {\n    return this._otherValues.slice();\n  }\n\n  set otherValues(values) {\n    this._otherValues = (values || []).slice();\n  }\n\n  get otherValue() {\n    if (!this.hasOtherValue) {\n      return null;\n    }\n\n    return this._otherValues[0];\n  }\n\n  isEqual(value) {\n    if (includes(this.selectedValues, value)) {\n      return true;\n    }\n\n    return this.otherValue === value;\n  }\n\n  contains(value) {\n    return this.isEqual(value);\n  }\n\n  startsWith(value) {\n    return this.contains(value);\n  }\n\n  // isLessThan(value) {\n  //   notImplemented();\n  // }\n\n  // isGreaterThan(value) {\n  //   notImplemented();\n  // }\n}\n"],"file":"choice-value.js"}