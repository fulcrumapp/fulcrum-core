{"version":3,"file":"changeset.js","names":["Changeset","attributes","updateFromAPIAttributes","attrs","_id","id","_metadata","metadata","_minLat","min_lat","_maxLat","max_lat","_minLon","min_lon","_maxLon","max_lon","_numberOfChanges","number_of_changes","_numberOfCreates","number_created","_numberOfUpdates","number_updated","_numberOfDeletes","number_deleted","_closedAt","DateUtils","parseISOTimestamp","closed_at","_closedBy","closed_by","_closedByID","closed_by_id","_createdAt","created_at","_createdBy","created_by","_createdByID","created_by_id","_updatedAt","updated_at","_updatedBy","updated_by","_updatedByID","updated_by_id","_formID","form_id","toJSON","json","formatISOTimestamp","format","metadataDescription","import_id","application","parts","Object","keys","key","value","push","toString","JSON","stringify","length","join","compact","application_version","browser","browser_version","platform","platform_version","device_manufacturer","device_model","type","coordinates"],"sources":["../src/changeset.js"],"sourcesContent":["import DateUtils from './utils/date-utils';\nimport { format } from 'util';\nimport compact from 'lodash.compact';\n\nexport default class Changeset {\n  constructor(attributes) {\n    this.updateFromAPIAttributes(attributes);\n  }\n\n  updateFromAPIAttributes(attrs) {\n    const attributes = attrs || {};\n\n    this._id = attributes.id;\n    this._metadata = attributes.metadata || {};\n    this._minLat = attributes.min_lat;\n    this._maxLat = attributes.max_lat;\n    this._minLon = attributes.min_lon;\n    this._maxLon = attributes.max_lon;\n    this._numberOfChanges = attributes.number_of_changes;\n    this._numberOfCreates = attributes.number_created;\n    this._numberOfUpdates = attributes.number_updated;\n    this._numberOfDeletes = attributes.number_deleted;\n    this._closedAt = DateUtils.parseISOTimestamp(attributes.closed_at);\n    this._closedBy = attributes.closed_by;\n    this._closedByID = attributes.closed_by_id;\n    this._createdAt = DateUtils.parseISOTimestamp(attributes.created_at);\n    this._createdBy = attributes.created_by;\n    this._createdByID = attributes.created_by_id;\n    this._updatedAt = DateUtils.parseISOTimestamp(attributes.updated_at);\n    this._updatedBy = attributes.updated_by;\n    this._updatedByID = attributes.updated_by_id;\n    this._formID = attributes.form_id;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this._id;\n    json.metadata = this._metadata || {};\n\n    json.min_lat = this._minLat;\n    json.max_lat = this._maxLat;\n    json.min_lon = this._minLon;\n    json.max_lon = this._maxLon;\n\n    json.number_of_changes = this._numberOfChanges;\n    json.number_created = this._numberOfCreates;\n    json.number_updated = this._numberOfUpdates;\n    json.number_deleted = this._numberOfDeletes;\n\n    json.closed_at = DateUtils.formatISOTimestamp(this._closedAt);\n    json.closed_by = this._closedBy;\n    json.closed_by_id = this._closedByID;\n\n    json.created_at = DateUtils.formatISOTimestamp(this._createdAt);\n    json.created_by = this._createdBy;\n    json.created_by_id = this._createdByID;\n\n    json.updated_at = DateUtils.formatISOTimestamp(this._updatedAt);\n    json.updated_by = this._updatedBy;\n    json.updated_by_id = this._updatedByID;\n\n    json.form_id = this._formID;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get isClosed() {\n    return this._closedAt != null;\n  }\n\n  get createdAt() {\n    return this._createdAt;\n  }\n\n  get updatedAt() {\n    return this._updatedAt;\n  }\n\n  get numberOfCreates() {\n    return this._numberOfCreates;\n  }\n\n  get numberOfUpdates() {\n    return this._numberOfUpdates;\n  }\n\n  get numberOfDeletes() {\n    return this._numberOfDeletes;\n  }\n\n  get displayValue() {\n    return format('Submitted %s by %s from %s',\n                  this._createdAt,\n                  this._createdBy,\n                  this.metadataDescription);\n  }\n\n  get application() {\n    if (this._metadata.import_id) {\n      return 'Fulcrum Importer';\n    }\n\n    return this._metadata.application;\n  }\n\n  get metadataIndexText() {\n    if (!this._metadata) {\n      return null;\n    }\n\n    const parts = [];\n\n    for (const key of Object.keys(this._metadata)) {\n      const value = this._metadata[key];\n\n      if (typeof value === 'string') {\n        parts.push(value);\n      } else if (typeof value === 'number') {\n        parts.push(value.toString());\n      } else if (value != null) {\n        parts.push(JSON.stringify(value));\n      }\n    }\n\n    return parts.length ? parts.join(' ') : null;\n  }\n\n  get metadataDescription() {\n    const parts = [\n      compact([ this.application,\n                this._metadata.application_version ]).join(' '),\n\n      compact([ this._metadata.browser,\n                this._metadata.browser_version ]).join(' '),\n\n      compact([ this._metadata.platform,\n                this._metadata.platform_version ]).join(' '),\n\n      compact([ this._metadata.device_manufacturer,\n                this._metadata.device_model ]).join(' ')\n    ];\n\n    return compact(parts).join(' / ');\n  }\n\n  get boundingBoxAsGeoJSON() {\n    if (this._minLat == null || this._maxLat == null ||\n        this._minLon == null || this._maxLon == null) {\n      return null;\n    }\n\n    if (this._minLat === this._maxLat && this._minLon === this._maxLon) {\n      return {\n        type: 'Point',\n        coordinates: [ this._minLon, this._minLat ]\n      };\n    }\n\n    if (this._minLat === this._maxLat || this._minLon === this._maxLon) {\n      return {\n        type: 'LineString',\n        coordinates: [ [ this._minLon, this._minLat ], [ this._maxLon, this._maxLat ] ]\n      };\n    }\n\n    return {\n      type: 'Polygon',\n      coordinates: [\n        [\n          [ this._minLon, this._minLat ],\n          [ this._minLon, this._maxLat ],\n          [ this._maxLon, this._maxLat ],\n          [ this._maxLon, this._minLat ],\n          [ this._minLon, this._minLat ]\n        ]\n      ]\n    };\n  }\n}\n"],"mappings":"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"}