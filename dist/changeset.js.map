{"version":3,"file":"changeset.js","names":["Changeset","attributes","updateFromAPIAttributes","attrs","_id","id","_metadata","metadata","_minLat","min_lat","_maxLat","max_lat","_minLon","min_lon","_maxLon","max_lon","_numberOfChanges","number_of_changes","_numberOfCreates","number_created","_numberOfUpdates","number_updated","_numberOfDeletes","number_deleted","_closedAt","DateUtils","parseISOTimestamp","closed_at","_closedBy","closed_by","_closedByID","closed_by_id","_createdAt","created_at","_createdBy","created_by","_createdByID","created_by_id","_updatedAt","updated_at","_updatedBy","updated_by","_updatedByID","updated_by_id","_formID","form_id","toJSON","json","formatISOTimestamp","format","metadataDescription","import_id","application","parts","Object","keys","key","value","push","toString","JSON","stringify","length","join","compact","application_version","browser","browser_version","platform","platform_version","device_manufacturer","device_model","type","coordinates"],"sources":["../src/changeset.js"],"sourcesContent":["import DateUtils from './utils/date-utils';\nimport { format } from 'util';\nimport compact from 'lodash.compact';\n\nexport default class Changeset {\n  constructor(attributes) {\n    this.updateFromAPIAttributes(attributes);\n  }\n\n  updateFromAPIAttributes(attrs) {\n    const attributes = attrs || {};\n\n    this._id = attributes.id;\n    this._metadata = attributes.metadata || {};\n    this._minLat = attributes.min_lat;\n    this._maxLat = attributes.max_lat;\n    this._minLon = attributes.min_lon;\n    this._maxLon = attributes.max_lon;\n    this._numberOfChanges = attributes.number_of_changes;\n    this._numberOfCreates = attributes.number_created;\n    this._numberOfUpdates = attributes.number_updated;\n    this._numberOfDeletes = attributes.number_deleted;\n    this._closedAt = DateUtils.parseISOTimestamp(attributes.closed_at);\n    this._closedBy = attributes.closed_by;\n    this._closedByID = attributes.closed_by_id;\n    this._createdAt = DateUtils.parseISOTimestamp(attributes.created_at);\n    this._createdBy = attributes.created_by;\n    this._createdByID = attributes.created_by_id;\n    this._updatedAt = DateUtils.parseISOTimestamp(attributes.updated_at);\n    this._updatedBy = attributes.updated_by;\n    this._updatedByID = attributes.updated_by_id;\n    this._formID = attributes.form_id;\n  }\n\n  toJSON() {\n    const json = {};\n\n    json.id = this._id;\n    json.metadata = this._metadata || {};\n\n    json.min_lat = this._minLat;\n    json.max_lat = this._maxLat;\n    json.min_lon = this._minLon;\n    json.max_lon = this._maxLon;\n\n    json.number_of_changes = this._numberOfChanges;\n    json.number_created = this._numberOfCreates;\n    json.number_updated = this._numberOfUpdates;\n    json.number_deleted = this._numberOfDeletes;\n\n    json.closed_at = DateUtils.formatISOTimestamp(this._closedAt);\n    json.closed_by = this._closedBy;\n    json.closed_by_id = this._closedByID;\n\n    json.created_at = DateUtils.formatISOTimestamp(this._createdAt);\n    json.created_by = this._createdBy;\n    json.created_by_id = this._createdByID;\n\n    json.updated_at = DateUtils.formatISOTimestamp(this._updatedAt);\n    json.updated_by = this._updatedBy;\n    json.updated_by_id = this._updatedByID;\n\n    json.form_id = this._formID;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  get isClosed() {\n    return this._closedAt != null;\n  }\n\n  get createdAt() {\n    return this._createdAt;\n  }\n\n  get updatedAt() {\n    return this._updatedAt;\n  }\n\n  get numberOfCreates() {\n    return this._numberOfCreates;\n  }\n\n  get numberOfUpdates() {\n    return this._numberOfUpdates;\n  }\n\n  get numberOfDeletes() {\n    return this._numberOfDeletes;\n  }\n\n  get displayValue() {\n    return format('Submitted %s by %s from %s',\n                  this._createdAt,\n                  this._createdBy,\n                  this.metadataDescription);\n  }\n\n  get application() {\n    if (this._metadata.import_id) {\n      return 'Fulcrum Importer';\n    }\n\n    return this._metadata.application;\n  }\n\n  get metadataIndexText() {\n    if (!this._metadata) {\n      return null;\n    }\n\n    const parts = [];\n\n    for (const key of Object.keys(this._metadata)) {\n      const value = this._metadata[key];\n\n      if (typeof value === 'string') {\n        parts.push(value);\n      } else if (typeof value === 'number') {\n        parts.push(value.toString());\n      } else if (value != null) {\n        parts.push(JSON.stringify(value));\n      }\n    }\n\n    return parts.length ? parts.join(' ') : null;\n  }\n\n  get metadataDescription() {\n    const parts = [\n      compact([ this.application,\n                this._metadata.application_version ]).join(' '),\n\n      compact([ this._metadata.browser,\n                this._metadata.browser_version ]).join(' '),\n\n      compact([ this._metadata.platform,\n                this._metadata.platform_version ]).join(' '),\n\n      compact([ this._metadata.device_manufacturer,\n                this._metadata.device_model ]).join(' ')\n    ];\n\n    return compact(parts).join(' / ');\n  }\n\n  get boundingBoxAsGeoJSON() {\n    if (this._minLat == null || this._maxLat == null ||\n        this._minLon == null || this._maxLon == null) {\n      return null;\n    }\n\n    if (this._minLat === this._maxLat && this._minLon === this._maxLon) {\n      return {\n        type: 'Point',\n        coordinates: [ this._minLon, this._minLat ]\n      };\n    }\n\n    if (this._minLat === this._maxLat || this._minLon === this._maxLon) {\n      return {\n        type: 'LineString',\n        coordinates: [ [ this._minLon, this._minLat ], [ this._maxLon, this._maxLat ] ]\n      };\n    }\n\n    return {\n      type: 'Polygon',\n      coordinates: [\n        [\n          [ this._minLon, this._minLat ],\n          [ this._minLon, this._maxLat ],\n          [ this._maxLon, this._maxLat ],\n          [ this._maxLon, this._minLat ],\n          [ this._minLon, this._minLat ]\n        ]\n      ]\n    };\n  }\n}\n"],"mappings":"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"}