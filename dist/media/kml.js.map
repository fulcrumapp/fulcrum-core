{"version":3,"file":"kml.js","names":["KML","render","tracks","timestamp","t","Date","toISOString","kml","push","kmlStart","kmlStyles","kmlPlacemarks","kmlEnd","join","trim","map","track","segments","length","kmlPlacemarkStart","kmlPlacemarkName","kmlPlacemarkStyle","kmlPlacemarkLineString","kmlPlacemarkMultiLineString","kmlPlacemarkExtendedData","kmlPlacemarkEnd","filter","o","isValid","firstLocation","time","lineStrings","segment","coordinates","locations","point","longitude","latitude","altitude","kmlPlacemarkLineStringProperties","data","kmlExtendedDataStart","kmlExtendedDataDate","kmlExtendedDataName","kmlExtendedDataLink","kmlExtendedDataEnd","id","kmlExtendedDataURL"],"sources":["../../src/media/kml.js"],"sourcesContent":["export default class KML {\n  static render(tracks) {\n    return new KML().render(tracks);\n  }\n\n  timestamp(t) {\n    if (t == null) {\n      return null;\n    }\n\n    return new Date(+t).toISOString();\n  }\n\n  render(tracks) {\n    const kml = [];\n\n    kml.push(this.kmlStart());\n    kml.push(this.kmlStyles());\n    kml.push(this.kmlPlacemarks(tracks));\n    kml.push(this.kmlEnd());\n\n    return kml.join('\\n').trim();\n  }\n\n  kmlPlacemarks(tracks) {\n    return tracks.map((track) => {\n      if (track.segments.length) {\n        const kml = [];\n\n        kml.push(this.kmlPlacemarkStart());\n        kml.push(this.kmlPlacemarkName(track));\n        kml.push(this.kmlPlacemarkStyle(track));\n\n        if (track.segments.length === 1) {\n          kml.push(this.kmlPlacemarkLineString(track.segments[0]));\n        } else {\n          kml.push(this.kmlPlacemarkMultiLineString(track));\n        }\n\n        kml.push(this.kmlPlacemarkExtendedData(track));\n        kml.push(this.kmlPlacemarkEnd());\n\n        return kml.join('\\n');\n      }\n\n      return null;\n    }).filter(o => o).join('\\n');\n  }\n\n  kmlStart() {\n    return `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<kml xmlns=\"http://www.opengis.net/kml/2.2\" xmlns:gx=\"http://www.google.com/kml/ext/2.2\">\n<Document>\n`;\n  }\n\n  kmlEnd() {\n    return '</Document></kml>';\n  }\n\n  kmlStyles() {\n    return `\n<Style id=\"line\">\n  <LineStyle>\n    <color>c000ffff</color>\n    <width>4</width>\n  </LineStyle>\n</Style>\n`;\n  }\n\n  kmlPlacemarkStart() {\n    return '<Placemark>';\n  }\n\n  kmlPlacemarkEnd() {\n    return '</Placemark>';\n  }\n\n  kmlPlacemarkName(track) {\n    return `<name>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</name>`;\n  }\n\n  kmlPlacemarkStyle(track) {\n    return '<styleUrl>#line</styleUrl>';\n  }\n\n  kmlPlacemarkMultiLineString(track) {\n    const lineStrings = track.segments.map((segment) => {\n      return this.kmlPlacemarkLineString(segment);\n    });\n\n    return `<MultiGeometry>${lineStrings.join('\\n')}</MultiGeometry>`;\n  }\n\n  kmlPlacemarkLineString(segment) {\n    const coordinates = segment.locations.map((point) => {\n      return [ point.longitude, point.latitude, point.altitude ].join(',');\n    }).join(' ');\n\n    return `<LineString>${this.kmlPlacemarkLineStringProperties()}<coordinates>${coordinates}</coordinates></LineString>`;\n  }\n\n  kmlPlacemarkLineStringProperties() {\n    return '<extrude>1</extrude><gx:altitudeMode>clampToGround</gx:altitudeMode>';\n  }\n\n  kmlPlacemarkExtendedData(track) {\n    const data = [];\n    data.push(this.kmlExtendedDataStart());\n    data.push(this.kmlExtendedDataDate(track));\n    data.push(this.kmlExtendedDataName(track));\n    data.push(this.kmlExtendedDataLink(track));\n    data.push(this.kmlExtendedDataEnd());\n    return data.join('\\n');\n  }\n\n  kmlExtendedDataStart() {\n    return '<ExtendedData>';\n  }\n\n  kmlExtendedDataDate(track) {\n    return `<Data name=\"Date\"><value>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</value></Data>`;\n  }\n\n  kmlExtendedDataEnd() {\n    return '</ExtendedData>';\n  }\n\n  kmlExtendedDataName(track) {\n    return `<Data name=\"Name\"><value><![CDATA[${track.id}]]></value></Data>`;\n  }\n\n  kmlExtendedDataLink(track) {\n    return `<Data name=\\\"Link\\\"><value><![CDATA[<a href=\\\"javascript:window.open('about:blank');\\\" onclick=\\\"window.open('${this.kmlExtendedDataURL(track)}')\\\" target=\\\"_new\\\">View Video</a>]]></value></Data>`;\n  }\n\n  kmlExtendedDataURL(track) {\n    return `https://web.fulcrumapp.com/videos/${track.id}`;\n  }\n}\n"],"mappings":"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"}