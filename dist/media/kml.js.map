{"version":3,"file":"kml.js","names":["KML","render","tracks","timestamp","t","Date","toISOString","kml","push","kmlStart","kmlStyles","kmlPlacemarks","kmlEnd","join","trim","map","track","segments","length","kmlPlacemarkStart","kmlPlacemarkName","kmlPlacemarkStyle","kmlPlacemarkLineString","kmlPlacemarkMultiLineString","kmlPlacemarkExtendedData","kmlPlacemarkEnd","filter","o","isValid","firstLocation","time","lineStrings","segment","coordinates","locations","point","longitude","latitude","altitude","kmlPlacemarkLineStringProperties","data","kmlExtendedDataStart","kmlExtendedDataDate","kmlExtendedDataName","kmlExtendedDataLink","kmlExtendedDataEnd","id","kmlExtendedDataURL"],"sources":["../../src/media/kml.js"],"sourcesContent":["export default class KML {\n  static render(tracks) {\n    return new KML().render(tracks);\n  }\n\n  timestamp(t) {\n    if (t == null) {\n      return null;\n    }\n\n    return new Date(+t).toISOString();\n  }\n\n  render(tracks) {\n    const kml = [];\n\n    kml.push(this.kmlStart());\n    kml.push(this.kmlStyles());\n    kml.push(this.kmlPlacemarks(tracks));\n    kml.push(this.kmlEnd());\n\n    return kml.join('\\n').trim();\n  }\n\n  kmlPlacemarks(tracks) {\n    return tracks.map((track) => {\n      if (track.segments.length) {\n        const kml = [];\n\n        kml.push(this.kmlPlacemarkStart());\n        kml.push(this.kmlPlacemarkName(track));\n        kml.push(this.kmlPlacemarkStyle(track));\n\n        if (track.segments.length === 1) {\n          kml.push(this.kmlPlacemarkLineString(track.segments[0]));\n        } else {\n          kml.push(this.kmlPlacemarkMultiLineString(track));\n        }\n\n        kml.push(this.kmlPlacemarkExtendedData(track));\n        kml.push(this.kmlPlacemarkEnd());\n\n        return kml.join('\\n');\n      }\n\n      return null;\n    }).filter(o => o).join('\\n');\n  }\n\n  kmlStart() {\n    return `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<kml xmlns=\"http://www.opengis.net/kml/2.2\" xmlns:gx=\"http://www.google.com/kml/ext/2.2\">\n<Document>\n`;\n  }\n\n  kmlEnd() {\n    return '</Document></kml>';\n  }\n\n  kmlStyles() {\n    return `\n<Style id=\"line\">\n  <LineStyle>\n    <color>c000ffff</color>\n    <width>4</width>\n  </LineStyle>\n</Style>\n`;\n  }\n\n  kmlPlacemarkStart() {\n    return '<Placemark>';\n  }\n\n  kmlPlacemarkEnd() {\n    return '</Placemark>';\n  }\n\n  kmlPlacemarkName(track) {\n    return `<name>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</name>`;\n  }\n\n  kmlPlacemarkStyle(track) {\n    return '<styleUrl>#line</styleUrl>';\n  }\n\n  kmlPlacemarkMultiLineString(track) {\n    const lineStrings = track.segments.map((segment) => {\n      return this.kmlPlacemarkLineString(segment);\n    });\n\n    return `<MultiGeometry>${lineStrings.join('\\n')}</MultiGeometry>`;\n  }\n\n  kmlPlacemarkLineString(segment) {\n    const coordinates = segment.locations.map((point) => {\n      return [ point.longitude, point.latitude, point.altitude ].join(',');\n    }).join(' ');\n\n    return `<LineString>${this.kmlPlacemarkLineStringProperties()}<coordinates>${coordinates}</coordinates></LineString>`;\n  }\n\n  kmlPlacemarkLineStringProperties() {\n    return '<extrude>1</extrude><gx:altitudeMode>clampToGround</gx:altitudeMode>';\n  }\n\n  kmlPlacemarkExtendedData(track) {\n    const data = [];\n    data.push(this.kmlExtendedDataStart());\n    data.push(this.kmlExtendedDataDate(track));\n    data.push(this.kmlExtendedDataName(track));\n    data.push(this.kmlExtendedDataLink(track));\n    data.push(this.kmlExtendedDataEnd());\n    return data.join('\\n');\n  }\n\n  kmlExtendedDataStart() {\n    return '<ExtendedData>';\n  }\n\n  kmlExtendedDataDate(track) {\n    return `<Data name=\"Date\"><value>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</value></Data>`;\n  }\n\n  kmlExtendedDataEnd() {\n    return '</ExtendedData>';\n  }\n\n  kmlExtendedDataName(track) {\n    return `<Data name=\"Name\"><value><![CDATA[${track.id}]]></value></Data>`;\n  }\n\n  kmlExtendedDataLink(track) {\n    return `<Data name=\\\"Link\\\"><value><![CDATA[<a href=\\\"javascript:window.open('about:blank');\\\" onclick=\\\"window.open('${this.kmlExtendedDataURL(track)}')\\\" target=\\\"_new\\\">View Video</a>]]></value></Data>`;\n  }\n\n  kmlExtendedDataURL(track) {\n    return `https://web.fulcrumapp.com/videos/${track.id}`;\n  }\n}\n"],"mappings":"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"}