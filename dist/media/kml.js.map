{"version":3,"sources":["../../src/media/kml.js"],"names":["KML","render","tracks","timestamp","t","Date","toISOString","kml","push","kmlStart","kmlStyles","kmlPlacemarks","kmlEnd","join","trim","map","track","segments","length","kmlPlacemarkStart","kmlPlacemarkName","kmlPlacemarkStyle","kmlPlacemarkLineString","kmlPlacemarkMultiLineString","kmlPlacemarkExtendedData","kmlPlacemarkEnd","filter","o","isValid","firstLocation","time","lineStrings","segment","coordinates","locations","point","longitude","latitude","altitude","kmlPlacemarkLineStringProperties","data","kmlExtendedDataStart","kmlExtendedDataDate","kmlExtendedDataName","kmlExtendedDataLink","kmlExtendedDataEnd","id","kmlExtendedDataURL"],"mappings":"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","sourcesContent":["export default class KML {\n  static render(tracks) {\n    return new KML().render(tracks);\n  }\n\n  timestamp(t) {\n    if (t == null) {\n      return null;\n    }\n\n    return new Date(+t).toISOString();\n  }\n\n  render(tracks) {\n    const kml = [];\n\n    kml.push(this.kmlStart());\n    kml.push(this.kmlStyles());\n    kml.push(this.kmlPlacemarks(tracks));\n    kml.push(this.kmlEnd());\n\n    return kml.join('\\n').trim();\n  }\n\n  kmlPlacemarks(tracks) {\n    return tracks.map((track) => {\n      if (track.segments.length) {\n        const kml = [];\n\n        kml.push(this.kmlPlacemarkStart());\n        kml.push(this.kmlPlacemarkName(track));\n        kml.push(this.kmlPlacemarkStyle(track));\n\n        if (track.segments.length === 1) {\n          kml.push(this.kmlPlacemarkLineString(track.segments[0]));\n        } else {\n          kml.push(this.kmlPlacemarkMultiLineString(track));\n        }\n\n        kml.push(this.kmlPlacemarkExtendedData(track));\n        kml.push(this.kmlPlacemarkEnd());\n\n        return kml.join('\\n');\n      }\n\n      return null;\n    }).filter(o => o).join('\\n');\n  }\n\n  kmlStart() {\n    return `\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<kml xmlns=\"http://www.opengis.net/kml/2.2\" xmlns:gx=\"http://www.google.com/kml/ext/2.2\">\n<Document>\n`;\n  }\n\n  kmlEnd() {\n    return '</Document></kml>';\n  }\n\n  kmlStyles() {\n    return `\n<Style id=\"line\">\n  <LineStyle>\n    <color>c000ffff</color>\n    <width>4</width>\n  </LineStyle>\n</Style>\n`;\n  }\n\n  kmlPlacemarkStart() {\n    return '<Placemark>';\n  }\n\n  kmlPlacemarkEnd() {\n    return '</Placemark>';\n  }\n\n  kmlPlacemarkName(track) {\n    return `<name>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</name>`;\n  }\n\n  kmlPlacemarkStyle(track) {\n    return '<styleUrl>#line</styleUrl>';\n  }\n\n  kmlPlacemarkMultiLineString(track) {\n    const lineStrings = track.segments.map((segment) => {\n      return this.kmlPlacemarkLineString(segment);\n    });\n\n    return `<MultiGeometry>${lineStrings.join('\\n')}</MultiGeometry>`;\n  }\n\n  kmlPlacemarkLineString(segment) {\n    const coordinates = segment.locations.map((point) => {\n      return [ point.longitude, point.latitude, point.altitude ].join(',');\n    }).join(' ');\n\n    return `<LineString>${this.kmlPlacemarkLineStringProperties()}<coordinates>${coordinates}</coordinates></LineString>`;\n  }\n\n  kmlPlacemarkLineStringProperties() {\n    return '<extrude>1</extrude><gx:altitudeMode>clampToGround</gx:altitudeMode>';\n  }\n\n  kmlPlacemarkExtendedData(track) {\n    const data = [];\n    data.push(this.kmlExtendedDataStart());\n    data.push(this.kmlExtendedDataDate(track));\n    data.push(this.kmlExtendedDataName(track));\n    data.push(this.kmlExtendedDataLink(track));\n    data.push(this.kmlExtendedDataEnd());\n    return data.join('\\n');\n  }\n\n  kmlExtendedDataStart() {\n    return '<ExtendedData>';\n  }\n\n  kmlExtendedDataDate(track) {\n    return `<Data name=\"Date\"><value>${track.isValid ? this.timestamp(track.firstLocation.time) : ''}</value></Data>`;\n  }\n\n  kmlExtendedDataEnd() {\n    return '</ExtendedData>';\n  }\n\n  kmlExtendedDataName(track) {\n    return `<Data name=\"Name\"><value><![CDATA[${track.id}]]></value></Data>`;\n  }\n\n  kmlExtendedDataLink(track) {\n    return `<Data name=\\\"Link\\\"><value><![CDATA[<a href=\\\"javascript:window.open('about:blank');\\\" onclick=\\\"window.open('${this.kmlExtendedDataURL(track)}')\\\" target=\\\"_new\\\">View Video</a>]]></value></Data>`;\n  }\n\n  kmlExtendedDataURL(track) {\n    return `https://web.fulcrumapp.com/videos/${track.id}`;\n  }\n}\n"],"file":"kml.js"}