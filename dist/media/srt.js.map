{"version":3,"file":"srt.js","names":["SRT","render","tracks","timestamp","t","x","_firstTimestamp","ms","padStart","Math","floor","ss","mm","hh","segments","points","time","parts","track","segment","point","push","srtEntry","length","join","trim","nextPoint","number","formatText","Date","toISOString","replace","latitude","toFixed","longitude","formatAltitude","formatSpeed","altitude","speed"],"sources":["../../src/media/srt.js"],"sourcesContent":["import padStart from 'lodash.padstart';\n\nexport default class SRT {\n  static render(tracks) {\n    return new SRT().render(tracks);\n  }\n\n  timestamp(t) {\n    let x = t - this._firstTimestamp;\n\n    const ms = padStart(Math.floor(x % 1000), 2, '0');\n\n    x /= 1000;\n\n    const ss = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const mm = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const hh = padStart(Math.floor(x % 24), 2, '0');\n\n    return `${hh}:${mm}:${ss},${ms}`;\n  }\n\n  render(tracks) {\n    this._firstTimestamp = tracks[0].segments[0].points[0].time;\n\n    const parts = [];\n\n    for (const track of tracks) {\n      for (const segment of track.segments) {\n        for (const point of segment.points) {\n          parts.push(this.srtEntry(point, segment.points[parts.length + 1], parts.length + 1));\n        }\n      }\n    }\n\n    return parts.join('\\n\\n').trim();\n  }\n\n  srtEntry(point, nextPoint, number) {\n    return `\n${number}\n${this.timestamp(point.time)} ${nextPoint != null ? '--> ' + this.timestamp(nextPoint.time) : ''}\n${this.formatText(point)}\n`.trim();\n  }\n\n  formatText(point) {\n    return [\n      new Date(point.time).toISOString().replace('T', ' ').replace('Z', '').replace(/\\.[\\d]{3}/, ''),\n      point.latitude != null ? point.latitude.toFixed(6) : '',\n      point.longitude != null ? point.longitude.toFixed(6) : '',\n      this.formatAltitude(point),\n      this.formatSpeed(point)\n    ].join(', ');\n  }\n\n  formatAltitude(point) {\n    if (point.altitude == null) {\n      return null;\n    }\n\n    const altitude = point.altitude.toFixed(0);\n\n    return (point.altitude > 0 ? '+' + altitude : '-' + altitude) + 'm';\n  }\n\n  formatSpeed(point) {\n    if (point.speed == null) {\n      return null;\n    }\n\n    const speed = (point.speed * 2.23694).toFixed(0);\n\n    return speed + 'mph';\n  }\n}\n"],"mappings":"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"}