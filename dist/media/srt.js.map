{"version":3,"sources":["../../src/media/srt.js"],"names":["SRT","render","tracks","timestamp","t","x","_firstTimestamp","ms","Math","floor","ss","mm","hh","segments","points","time","parts","track","segment","point","push","srtEntry","length","join","trim","nextPoint","number","formatText","Date","toISOString","replace","latitude","toFixed","longitude","formatAltitude","formatSpeed","altitude","speed"],"mappings":"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","sourcesContent":["import padStart from 'lodash.padstart';\n\nexport default class SRT {\n  static render(tracks) {\n    return new SRT().render(tracks);\n  }\n\n  timestamp(t) {\n    let x = t - this._firstTimestamp;\n\n    const ms = padStart(Math.floor(x % 1000), 2, '0');\n\n    x /= 1000;\n\n    const ss = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const mm = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const hh = padStart(Math.floor(x % 24), 2, '0');\n\n    return `${hh}:${mm}:${ss},${ms}`;\n  }\n\n  render(tracks) {\n    this._firstTimestamp = tracks[0].segments[0].points[0].time;\n\n    const parts = [];\n\n    for (const track of tracks) {\n      for (const segment of track.segments) {\n        for (const point of segment.points) {\n          parts.push(this.srtEntry(point, segment.points[parts.length + 1], parts.length + 1));\n        }\n      }\n    }\n\n    return parts.join('\\n\\n').trim();\n  }\n\n  srtEntry(point, nextPoint, number) {\n    return `\n${number}\n${this.timestamp(point.time)} ${nextPoint != null ? '--> ' + this.timestamp(nextPoint.time) : ''}\n${this.formatText(point)}\n`.trim();\n  }\n\n  formatText(point) {\n    return [\n      new Date(point.time).toISOString().replace('T', ' ').replace('Z', '').replace(/\\.[\\d]{3}/, ''),\n      point.latitude != null ? point.latitude.toFixed(6) : '',\n      point.longitude != null ? point.longitude.toFixed(6) : '',\n      this.formatAltitude(point),\n      this.formatSpeed(point)\n    ].join(', ');\n  }\n\n  formatAltitude(point) {\n    if (point.altitude == null) {\n      return null;\n    }\n\n    const altitude = point.altitude.toFixed(0);\n\n    return (point.altitude > 0 ? '+' + altitude : '-' + altitude) + 'm';\n  }\n\n  formatSpeed(point) {\n    if (point.speed == null) {\n      return null;\n    }\n\n    const speed = (point.speed * 2.23694).toFixed(0);\n\n    return speed + 'mph';\n  }\n}\n"],"file":"srt.js"}