{"version":3,"file":"srt.js","names":["SRT","render","tracks","timestamp","t","x","_firstTimestamp","ms","padStart","Math","floor","ss","mm","hh","segments","points","time","parts","track","segment","point","push","srtEntry","length","join","trim","nextPoint","number","formatText","Date","toISOString","replace","latitude","toFixed","longitude","formatAltitude","formatSpeed","altitude","speed"],"sources":["../../src/media/srt.js"],"sourcesContent":["import padStart from 'lodash.padstart';\n\nexport default class SRT {\n  static render(tracks) {\n    return new SRT().render(tracks);\n  }\n\n  timestamp(t) {\n    let x = t - this._firstTimestamp;\n\n    const ms = padStart(Math.floor(x % 1000), 2, '0');\n\n    x /= 1000;\n\n    const ss = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const mm = padStart(Math.floor(x % 60), 2, '0');\n\n    x /= 60;\n\n    const hh = padStart(Math.floor(x % 24), 2, '0');\n\n    return `${hh}:${mm}:${ss},${ms}`;\n  }\n\n  render(tracks) {\n    this._firstTimestamp = tracks[0].segments[0].points[0].time;\n\n    const parts = [];\n\n    for (const track of tracks) {\n      for (const segment of track.segments) {\n        for (const point of segment.points) {\n          parts.push(this.srtEntry(point, segment.points[parts.length + 1], parts.length + 1));\n        }\n      }\n    }\n\n    return parts.join('\\n\\n').trim();\n  }\n\n  srtEntry(point, nextPoint, number) {\n    return `\n${number}\n${this.timestamp(point.time)} ${nextPoint != null ? '--> ' + this.timestamp(nextPoint.time) : ''}\n${this.formatText(point)}\n`.trim();\n  }\n\n  formatText(point) {\n    return [\n      new Date(point.time).toISOString().replace('T', ' ').replace('Z', '').replace(/\\.[\\d]{3}/, ''),\n      point.latitude != null ? point.latitude.toFixed(6) : '',\n      point.longitude != null ? point.longitude.toFixed(6) : '',\n      this.formatAltitude(point),\n      this.formatSpeed(point)\n    ].join(', ');\n  }\n\n  formatAltitude(point) {\n    if (point.altitude == null) {\n      return null;\n    }\n\n    const altitude = point.altitude.toFixed(0);\n\n    return (point.altitude > 0 ? '+' + altitude : '-' + altitude) + 'm';\n  }\n\n  formatSpeed(point) {\n    if (point.speed == null) {\n      return null;\n    }\n\n    const speed = (point.speed * 2.23694).toFixed(0);\n\n    return speed + 'mph';\n  }\n}\n"],"mappings":"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"}